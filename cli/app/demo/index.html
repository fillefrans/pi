<!doctype html>
<html>
<head>
  <script>
    var 
      π  = {
        DEBUG : true,
        __sessionstart : (new Date()).getTime()
      };
  </script>

  <title>π demo</title>

  <meta charset="utf-8">
  <meta name="viewport"  content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">  
  
  <!-- the core CSS from pi -->
  <link rel="stylesheet" href="../../assets/css/pi.core.css">
  <!-- the app CSS -->
  <link rel="stylesheet" href="assets/css/pi.app.css">

  <link rel="shortcut icon" href="assets/ico/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/icon-114.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72"   href="assets/ico/icon-72.png">
  <link rel="apple-touch-icon-precomposed"                 href="assets/ico/icon-57.png">
</head>
 
<body class="pi">

  <div id="login" class="pcl" data-name="pcl.dialogs.login">
    <!--  set classes "pcl" and "component" to mark as PCL component -->
    <!--  then the PCL bootstrapper will load the component given in attribute "data-name" -->
  </div>


  <div id="numberstation" class="pcl" data-name="pcl.debug.numberstation">
    <script>

      var 


        numberstation = document.getElementById("numberstation"),
        randomWalk = {

          eventsource : null,
          starttime   : null,
          element     : null,

          __onerror : function (err) {
            pi.log("Error in randomWalk: ", err);
          },


          onRandomWalk : function (message) {
            var
              randomNumber  = JSON.parse(message.data),
              self          = pi.maverick.randomWalk;

            if(self.element) {
              self.element.innerHTML = randomNumber;
            }
          },

          run : function() {
            pi.log("starting randomWalk listener...");
            this.starttime    = new Date().getTime();
            this.element      = document.getElementById("randomwalk");
            this.eventsource  = pi.listen("pi.service.numberstation.randomwalk", this.onRandomWalk, this.__onerror);
            this.eventsource.addEventListener("data", this.onRandomWalk, false);
            pi.log("done.", this.eventsource);
            pi.log("onmessage:", this.eventsource.onmessage);
          }
        };


        window.addEventListener("pi.session.start", function() {
          pi.maverick.randomWalk = randomWalk;
          pi.maverick.randomWalk.run();
        }, false);


    </script>
    <div id="randomwalk"></div>

  </div>

  <div id="debug" class="pcl" data-name="pcl.debug.debugger">

    <script>
      var

        fullscreenclick = function (event) {
          if(document.fullscreen) {
            return pi.fullscreen.exit();
          }
          else {
            return pi.fullscreen.request();
          }
        },

        onopen = function (event) {
          pi.log("DEBUG: onopen - ", event);
        },

        onerror = function (error) {
          pi.log("DEBUG: onerror - ", error);
        },


        ondebugdata = function (message) {

          pi.log("DATA: " + JSON.parse(message.data));
        },

        ondebugmessage = function (message) {
          pi.log("DEBUG: ", message);

        },

        init = function() {
          var
            source = pi.listen("pi.*", ondebugmessage, onerror);

          if(source) {
            source.addEventListener("open", onopen, false);
            // source.addEventListener("message", ondebugmessage, false);
            source.addEventListener("data", ondebugdata, false);
          } else {
            pi.log("Error: source is no good: ", source);
          }

        },



        onload = function (evt) {
          pi.log("ONLOAD debugger!", evt);
          init();            
        };


      window.addEventListener("pi.session.start", onload, false);
    </script>

    <div id="console"></div>

  </div>


  <script src="assets/js/lib/gsap/TimelineMax.min.js"></script>
  <script src="assets/js/lib/gsap/TweenMax.min.js"></script>
  <script src="assets/js/lib/raphael.min.js"></script>
  <script src="../../assets/js/lib/crossfilter.min.js"></script>


  <!--  bootstrap pi -->
  <script src="../../assets/js/pi.core.js"></script>


  <!--  bootstrap pcl 
    <script src="../../assets/js/pi.pcl.js"></script>
  -->

</body>
</html>